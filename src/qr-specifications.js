// taken from https://www.thonky.com/qr-code-tutorial/

const Byte = require("./byte"),
  BytePolynomial = require("./byte-polynomial");

const errorCorrectionLevelToBitStr = {
  "L": "01",
  "M": "00",
  "Q": "11",
  "H": "10"
};

const formatGeneratorPolynomial =
  new BytePolynomial([1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1]);

const versionGeneratorPolynomial =
  new BytePolynomial([1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1]);

const messageGeneratorPolynomial = k => {
  const g = new BytePolynomial([1]);

  for (let i = 0; i < k; ++i)
    g.multiplyWith(new BytePolynomial([Byte.powerOf2(i), 1]));

  return g;
};

const formatMask =
  [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0];

const cornerPattern = [
  [1, 1, 1, 1, 1, 1, 1, 0],
  [1, 0, 0, 0, 0, 0, 1, 0],
  [1, 0, 1, 1, 1, 0, 1, 0],
  [1, 0, 1, 1, 1, 0, 1, 0],
  [1, 0, 1, 1, 1, 0, 1, 0],
  [1, 0, 0, 0, 0, 0, 1, 0],
  [1, 1, 1, 1, 1, 1, 1, 0],
  [0, 0, 0, 0, 0, 0, 0, 0]
];

const alignmentPattern = [
  [1, 1, 1, 1, 1],
  [1, 0, 0, 0, 1],
  [1, 0, 1, 0, 1],
  [1, 0, 0, 0, 1],
  [1, 1, 1, 1, 1]
];

const maskPatterns = [
  (i, j) => (i + j) % 2 === 0,
  i => i % 2 === 0,
  j => j % 3 === 0,
  (i, j) => (i + j) % 3 === 0,
  (i, j) => (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0,
  (i, j) => ((i * j) % 2) + ((i * j) % 3) === 0,
  (i, j) => (((i * j) % 2) + ((i * j) % 3)) % 2 === 0,
  (i, j) => (((i + j) % 2) + ((i * j) % 3)) % 2 === 0
];

const alignmentPatternPositions = [
  [],
  [6, 18],
  [6, 22],
  [6, 26],
  [6, 30],
  [6, 34],
  [6, 22, 38],
  [6, 24, 42],
  [6, 26, 46],
  [6, 28, 50],
  [6, 30, 54],
  [6, 32, 58],
  [6, 34, 62],
  [6, 26, 46, 66],
  [6, 26, 48, 70],
  [6, 26, 50, 74],
  [6, 30, 54, 78],
  [6, 30, 56, 82],
  [6, 30, 58, 86],
  [6, 34, 62, 90],
  [6, 28, 50, 72, 94],
  [6, 26, 50, 74, 98],
  [6, 30, 54, 78, 102],
  [6, 28, 54, 80, 106],
  [6, 32, 58, 84, 110],
  [6, 30, 58, 86, 114],
  [6, 34, 62, 90, 118],
  [6, 26, 50, 74, 98, 122],
  [6, 30, 54, 78, 102, 126],
  [6, 26, 52, 78, 104, 130],
  [6, 30, 56, 82, 108, 134],
  [6, 34, 60, 86, 112, 138],
  [6, 30, 58, 86, 114, 142],
  [6, 34, 62, 90, 118, 146],
  [6, 30, 54, 78, 102, 126, 150],
  [6, 24, 50, 76, 102, 128, 154],
  [6, 28, 54, 80, 106, 132, 158],
  [6, 32, 58, 84, 110, 136, 162],
  [6, 26, 54, 82, 110, 138, 166],
  [6, 30, 58, 86, 114, 142, 170]
];

const capacityAndGroups = {
  "L": [
    { "db": 19, "ec": 7, "groups": [[1, 19]] },
    { "db": 34, "ec": 10, "groups": [[1, 34]] },
    { "db": 55, "ec": 15, "groups": [[1, 55]] },
    { "db": 80, "ec": 20, "groups": [[1, 80]] },
    { "db": 108, "ec": 26, "groups": [[1, 108]] },
    { "db": 136, "ec": 18, "groups": [[2, 68]] },
    { "db": 156, "ec": 20, "groups": [[2, 78]] },
    { "db": 194, "ec": 24, "groups": [[2, 97]] },
    { "db": 232, "ec": 30, "groups": [[2, 116]] },
    { "db": 274, "ec": 18, "groups": [[2, 68], [2, 69]] },
    { "db": 324, "ec": 20, "groups": [[4, 81]] },
    { "db": 370, "ec": 24, "groups": [[2, 92], [2, 93]] },
    { "db": 428, "ec": 26, "groups": [[4, 107]] },
    { "db": 461, "ec": 30, "groups": [[3, 115], [1, 116]] },
    { "db": 523, "ec": 22, "groups": [[5, 87], [1, 88]] },
    { "db": 589, "ec": 24, "groups": [[5, 98], [1, 99]] },
    { "db": 647, "ec": 28, "groups": [[1, 107], [5, 108]] },
    { "db": 721, "ec": 30, "groups": [[5, 120], [1, 121]] },
    { "db": 795, "ec": 28, "groups": [[3, 113], [4, 114]] },
    { "db": 861, "ec": 28, "groups": [[3, 107], [5, 108]] },
    { "db": 932, "ec": 28, "groups": [[4, 116], [4, 117]] },
    { "db": 1006, "ec": 28, "groups": [[2, 111], [7, 112]] },
    { "db": 1094, "ec": 30, "groups": [[4, 121], [5, 122]] },
    { "db": 1174, "ec": 30, "groups": [[6, 117], [4, 118]] },
    { "db": 1276, "ec": 26, "groups": [[8, 106], [4, 107]] },
    { "db": 1370, "ec": 28, "groups": [[10, 114], [2, 115]] },
    { "db": 1468, "ec": 30, "groups": [[8, 122], [4, 123]] },
    { "db": 1531, "ec": 30, "groups": [[3, 117], [10, 118]] },
    { "db": 1631, "ec": 30, "groups": [[7, 116], [7, 117]] },
    { "db": 1735, "ec": 30, "groups": [[5, 115], [10, 116]] },
    { "db": 1843, "ec": 30, "groups": [[13, 115], [3, 116]] },
    { "db": 1955, "ec": 30, "groups": [[17, 115]] },
    { "db": 2071, "ec": 30, "groups": [[17, 115], [1, 116]] },
    { "db": 2191, "ec": 30, "groups": [[13, 115], [6, 116]] },
    { "db": 2306, "ec": 30, "groups": [[12, 121], [7, 122]] },
    { "db": 2434, "ec": 30, "groups": [[6, 121], [14, 122]] },
    { "db": 2566, "ec": 30, "groups": [[17, 122], [4, 123]] },
    { "db": 2702, "ec": 30, "groups": [[4, 122], [18, 123]] },
    { "db": 2812, "ec": 30, "groups": [[20, 117], [4, 118]] },
    { "db": 2956, "ec": 30, "groups": [[19, 118], [6, 119]] }
  ],

  "M": [
    { "db": 16, "ec": 10, "groups": [[1, 16]] },
    { "db": 28, "ec": 16, "groups": [[1, 28]] },
    { "db": 44, "ec": 26, "groups": [[1, 44]] },
    { "db": 64, "ec": 18, "groups": [[2, 32]] },
    { "db": 86, "ec": 24, "groups": [[2, 43]] },
    { "db": 108, "ec": 16, "groups": [[4, 27]] },
    { "db": 124, "ec": 18, "groups": [[4, 31]] },
    { "db": 154, "ec": 22, "groups": [[2, 38], [2, 39]] },
    { "db": 182, "ec": 22, "groups": [[3, 36], [2, 37]] },
    { "db": 216, "ec": 26, "groups": [[4, 43], [1, 44]] },
    { "db": 254, "ec": 30, "groups": [[1, 50], [4, 51]] },
    { "db": 290, "ec": 22, "groups": [[6, 36], [2, 37]] },
    { "db": 334, "ec": 22, "groups": [[8, 37], [1, 38]] },
    { "db": 365, "ec": 24, "groups": [[4, 40], [5, 41]] },
    { "db": 415, "ec": 24, "groups": [[5, 41], [5, 42]] },
    { "db": 453, "ec": 28, "groups": [[7, 45], [3, 46]] },
    { "db": 507, "ec": 28, "groups": [[10, 46], [1, 47]] },
    { "db": 563, "ec": 26, "groups": [[9, 43], [4, 44]] },
    { "db": 627, "ec": 26, "groups": [[3, 44], [11, 45]] },
    { "db": 669, "ec": 26, "groups": [[3, 41], [13, 42]] },
    { "db": 714, "ec": 26, "groups": [[17, 42]] },
    { "db": 782, "ec": 28, "groups": [[17, 46]] },
    { "db": 860, "ec": 28, "groups": [[4, 47], [14, 48]] },
    { "db": 914, "ec": 28, "groups": [[6, 45], [14, 46]] },
    { "db": 1000, "ec": 28, "groups": [[8, 47], [13, 48]] },
    { "db": 1062, "ec": 28, "groups": [[19, 46], [4, 47]] },
    { "db": 1128, "ec": 28, "groups": [[22, 45], [3, 46]] },
    { "db": 1193, "ec": 28, "groups": [[3, 45], [23, 46]] },
    { "db": 1267, "ec": 28, "groups": [[21, 45], [7, 46]] },
    { "db": 1373, "ec": 28, "groups": [[19, 47], [10, 48]] },
    { "db": 1455, "ec": 28, "groups": [[2, 46], [29, 47]] },
    { "db": 1541, "ec": 28, "groups": [[10, 46], [23, 47]] },
    { "db": 1631, "ec": 28, "groups": [[14, 46], [21, 47]] },
    { "db": 1725, "ec": 28, "groups": [[14, 46], [23, 47]] },
    { "db": 1812, "ec": 28, "groups": [[12, 47], [26, 48]] },
    { "db": 1914, "ec": 28, "groups": [[6, 47], [34, 48]] },
    { "db": 1992, "ec": 28, "groups": [[29, 46], [14, 47]] },
    { "db": 2102, "ec": 28, "groups": [[13, 46], [32, 47]] },
    { "db": 2216, "ec": 28, "groups": [[40, 47], [7, 48]] },
    { "db": 2334, "ec": 28, "groups": [[18, 47], [31, 48]] }
  ],

  "Q": [
    { "db": 13, "ec": 13, "groups": [[1, 13]] },
    { "db": 22, "ec": 22, "groups": [[1, 22]] },
    { "db": 34, "ec": 18, "groups": [[2, 17]] },
    { "db": 48, "ec": 26, "groups": [[2, 24]] },
    { "db": 62, "ec": 18, "groups": [[2, 15], [2, 16]] },
    { "db": 76, "ec": 24, "groups": [[4, 19]] },
    { "db": 88, "ec": 18, "groups": [[2, 14], [4, 15]] },
    { "db": 110, "ec": 22, "groups": [[4, 18], [2, 19]] },
    { "db": 132, "ec": 20, "groups": [[4, 16], [4, 17]] },
    { "db": 154, "ec": 24, "groups": [[6, 19], [2, 20]] },
    { "db": 180, "ec": 28, "groups": [[4, 22], [4, 23]] },
    { "db": 206, "ec": 26, "groups": [[4, 20], [6, 21]] },
    { "db": 244, "ec": 24, "groups": [[8, 20], [4, 21]] },
    { "db": 261, "ec": 20, "groups": [[11, 16], [5, 17]] },
    { "db": 295, "ec": 30, "groups": [[5, 24], [7, 25]] },
    { "db": 325, "ec": 24, "groups": [[15, 19], [2, 20]] },
    { "db": 367, "ec": 28, "groups": [[1, 22], [15, 23]] },
    { "db": 397, "ec": 28, "groups": [[17, 22], [1, 23]] },
    { "db": 445, "ec": 26, "groups": [[17, 21], [4, 22]] },
    { "db": 485, "ec": 30, "groups": [[15, 24], [5, 25]] },
    { "db": 512, "ec": 28, "groups": [[17, 22], [6, 23]] },
    { "db": 568, "ec": 30, "groups": [[7, 24], [16, 25]] },
    { "db": 614, "ec": 30, "groups": [[11, 24], [14, 25]] },
    { "db": 664, "ec": 30, "groups": [[11, 24], [16, 25]] },
    { "db": 718, "ec": 30, "groups": [[7, 24], [22, 25]] },
    { "db": 754, "ec": 28, "groups": [[28, 22], [6, 23]] },
    { "db": 808, "ec": 30, "groups": [[8, 23], [26, 24]] },
    { "db": 871, "ec": 30, "groups": [[4, 24], [31, 25]] },
    { "db": 911, "ec": 30, "groups": [[1, 23], [37, 24]] },
    { "db": 985, "ec": 30, "groups": [[15, 24], [25, 25]] },
    { "db": 1033, "ec": 30, "groups": [[42, 24], [1, 25]] },
    { "db": 1115, "ec": 30, "groups": [[10, 24], [35, 25]] },
    { "db": 1171, "ec": 30, "groups": [[29, 24], [19, 25]] },
    { "db": 1231, "ec": 30, "groups": [[44, 24], [7, 25]] },
    { "db": 1286, "ec": 30, "groups": [[39, 24], [14, 25]] },
    { "db": 1354, "ec": 30, "groups": [[46, 24], [10, 25]] },
    { "db": 1426, "ec": 30, "groups": [[49, 24], [10, 25]] },
    { "db": 1502, "ec": 30, "groups": [[48, 24], [14, 25]] },
    { "db": 1582, "ec": 30, "groups": [[43, 24], [22, 25]] },
    { "db": 1666, "ec": 30, "groups": [[34, 24], [34, 25]] }
  ],

  "H": [
    { "db": 9, "ec": 17, "groups": [[1, 9]] },
    { "db": 16, "ec": 28, "groups": [[1, 16]] },
    { "db": 26, "ec": 22, "groups": [[2, 13]] },
    { "db": 36, "ec": 16, "groups": [[4, 9]] },
    { "db": 46, "ec": 22, "groups": [[2, 11], [2, 12]] },
    { "db": 60, "ec": 28, "groups": [[4, 15]] },
    { "db": 66, "ec": 26, "groups": [[4, 13], [1, 14]] },
    { "db": 86, "ec": 26, "groups": [[4, 14], [2, 15]] },
    { "db": 100, "ec": 24, "groups": [[4, 12], [4, 13]] },
    { "db": 122, "ec": 28, "groups": [[6, 15], [2, 16]] },
    { "db": 140, "ec": 24, "groups": [[3, 12], [8, 13]] },
    { "db": 158, "ec": 28, "groups": [[7, 14], [4, 15]] },
    { "db": 180, "ec": 22, "groups": [[12, 11], [4, 12]] },
    { "db": 197, "ec": 24, "groups": [[11, 12], [5, 13]] },
    { "db": 223, "ec": 24, "groups": [[11, 12], [7, 13]] },
    { "db": 253, "ec": 30, "groups": [[3, 15], [13, 16]] },
    { "db": 283, "ec": 28, "groups": [[2, 14], [17, 15]] },
    { "db": 313, "ec": 28, "groups": [[2, 14], [19, 15]] },
    { "db": 341, "ec": 26, "groups": [[9, 13], [16, 14]] },
    { "db": 385, "ec": 28, "groups": [[15, 15], [10, 16]] },
    { "db": 406, "ec": 30, "groups": [[19, 16], [6, 17]] },
    { "db": 442, "ec": 24, "groups": [[34, 13]] },
    { "db": 464, "ec": 30, "groups": [[16, 15], [14, 16]] },
    { "db": 514, "ec": 30, "groups": [[30, 16], [2, 17]] },
    { "db": 538, "ec": 30, "groups": [[22, 15], [13, 16]] },
    { "db": 596, "ec": 30, "groups": [[33, 16], [4, 17]] },
    { "db": 628, "ec": 30, "groups": [[12, 15], [28, 16]] },
    { "db": 661, "ec": 30, "groups": [[11, 15], [31, 16]] },
    { "db": 701, "ec": 30, "groups": [[19, 15], [26, 16]] },
    { "db": 745, "ec": 30, "groups": [[23, 15], [25, 16]] },
    { "db": 793, "ec": 30, "groups": [[23, 15], [28, 16]] },
    { "db": 845, "ec": 30, "groups": [[19, 15], [35, 16]] },
    { "db": 901, "ec": 30, "groups": [[11, 15], [46, 16]] },
    { "db": 961, "ec": 30, "groups": [[59, 16], [1, 17]] },
    { "db": 986, "ec": 30, "groups": [[22, 15], [41, 16]] },
    { "db": 1054, "ec": 30, "groups": [[2, 15], [64, 16]] },
    { "db": 1096, "ec": 30, "groups": [[24, 15], [46, 16]] },
    { "db": 1142, "ec": 30, "groups": [[42, 15], [32, 16]] },
    { "db": 1222, "ec": 30, "groups": [[10, 15], [67, 16]] },
    { "db": 1276, "ec": 30, "groups": [[20, 15], [61, 16]] }
  ]
};

module.exports = {
  alignmentPattern,
  alignmentPatternPositions,
  capacityAndGroups,
  cornerPattern,
  errorCorrectionLevelToBitStr,
  formatGeneratorPolynomial,
  formatMask,
  maskPatterns,
  messageGeneratorPolynomial,
  versionGeneratorPolynomial
};
